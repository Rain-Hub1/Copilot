<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA Assistente GitHub</title>
    <script>
        (function() {
            const K = 'github-ai-theme';
            const q = window.matchMedia('(prefers-color-scheme: dark)');
            let theme = localStorage.getItem(K) || 'auto';
            if (theme === 'auto') { theme = q.matches ? 'dark' : 'light'; }
            document.documentElement.setAttribute('data-color-mode', theme);
        })();
    </script>
    <style>
        :root, [data-color-mode=light] {
            --color-canvas-default: #ffffff;
            --color-canvas-subtle: #f6f8fa;
            --color-fg-default: #1f2328;
            --color-fg-muted: #636c76;
            --color-border-default: #d1d9e0;
            --color-border-muted: #d1d9e0b3;
            --color-neutral-muted: #afb8c133;
            --color-accent-fg: #0969da;
            --color-accent-emphasis: #0969da;
            --color-success-emphasis: #1f883d;
            --color-danger-fg: #d1242f;
            --color-danger-emphasis: #cf222e;
            --color-btn-bg: #f6f8fa;
            --color-btn-border: #1f232826;
            --color-btn-text: #24292f;
            --color-btn-hover-bg: #f3f4f6;
            --color-btn-primary-bg: #1f883d;
            --color-btn-primary-text: #ffffff;
            --color-btn-primary-hover-bg: #1a7f37;
            --color-shadow-small: 0 1px 0 rgba(31,35,40,0.04);
            --color-shadow-medium: 0 3px 6px rgba(140,149,159,0.15);
        }
        
        [data-color-mode=dark] {
            --color-canvas-default: #0d1117;
            --color-canvas-subtle: #161b22;
            --color-fg-default: #e6edf3;
            --color-fg-muted: #7d8590;
            --color-border-default: #30363d;
            --color-border-muted: #30363db3;
            --color-neutral-muted: #6e768166;
            --color-accent-fg: #2f81f7;
            --color-accent-emphasis: #1f6feb;
            --color-success-emphasis: #238636;
            --color-danger-fg: #f85149;
            --color-danger-emphasis: #da3633;
            --color-btn-bg: #21262d;
            --color-btn-border: #8b949e1a;
            --color-btn-text: #c9d1d9;
            --color-btn-hover-bg: #30363d;
            --color-btn-primary-bg: #238636;
            --color-btn-primary-text: #ffffff;
            --color-btn-primary-hover-bg: #2ea043;
            --color-shadow-small: 0 0 transparent;
            --color-shadow-medium: 0 3px 6px #010409;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: var(--color-fg-default);
            background-color: var(--color-canvas-subtle);
            margin: 0;
            padding: 0;
        }

        main {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem;
        }

        .layout {
            display: flex;
            gap: 24px;
        }

        /* Navigation Sidebar */
        #app-nav {
            display: none;
            flex-direction: column;
            gap: 4px;
            width: 260px;
            flex-shrink: 0;
            padding: 16px;
            background-color: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            height: fit-content;
        }

        #app-nav a {
            padding: 8px 12px;
            border-radius: 6px;
            text-decoration: none;
            color: var(--color-fg-default);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background-color 0.2s ease;
        }

        #app-nav a:hover {
            background-color: var(--color-neutral-muted);
        }

        #app-nav a.active {
            background-color: var(--color-neutral-muted);
            font-weight: 600;
        }

        #app-nav svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* Collapsible */
        .collapsible {
            margin: 16px 0;
        }

        .collapsible-header {
            cursor: pointer;
            padding: 8px 12px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .collapsible-header:hover {
            background-color: var(--color-neutral-muted);
        }

        .collapsible-header .arrow {
            transition: transform 0.2s ease;
        }

        .collapsible-header.open .arrow {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content a {
            font-weight: 400;
            color: var(--color-fg-muted);
            padding-left: 24px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 13px;
        }

        /* Content Container */
        #content-container {
            flex-grow: 1;
            min-width: 0;
        }

        .page {
            display: none;
            background-color: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            overflow: hidden;
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        .page-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--color-border-default);
            display: flex;
            align-items: center;
            gap: 16px;
            background-color: var(--color-canvas-subtle);
        }

        .page-header h1 {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }

        .page-content {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
        }

        /* Forms */
        .form-container {
            max-width: 440px;
            margin: 0 auto;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 14px;
        }

        input[type="email"],
        input[type="password"],
        input[type="text"],
        input[type="search"] {
            width: 100%;
            padding: 8px 12px;
            font-size: 14px;
            line-height: 20px;
            color: var(--color-fg-default);
            background-color: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            outline: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        input:focus {
            border-color: var(--color-accent-emphasis);
            box-shadow: 0 0 0 3px rgba(31, 136, 61, 0.12);
        }

        .form-group {
            margin-bottom: 16px;
        }

        /* Buttons */
        button, .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 5px 16px;
            font-size: 14px;
            font-weight: 500;
            line-height: 20px;
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
            border: 1px solid;
            border-radius: 6px;
            text-decoration: none;
            transition: all 0.2s cubic-bezier(0.3, 0, 0.5, 1);
            color: var(--color-btn-text);
            background-color: var(--color-btn-bg);
            border-color: var(--color-btn-border);
            box-shadow: var(--color-shadow-small), var(--color-shadow-medium);
        }

        button:hover, .button:hover {
            background-color: var(--color-btn-hover-bg);
            text-decoration: none;
        }

        button.primary, .button.primary {
            color: var(--color-btn-primary-text);
            background-color: var(--color-btn-primary-bg);
            border-color: var(--color-btn-primary-bg);
        }

        button.primary:hover, .button.primary:hover {
            background-color: var(--color-btn-primary-hover-bg);
        }

        button.danger {
            color: var(--color-danger-fg);
        }

        button.danger:hover {
            color: #ffffff;
            background-color: var(--color-danger-emphasis);
            border-color: var(--color-danger-emphasis);
        }

        button.full-width, .button.full-width {
            width: 100%;
            margin-top: 8px;
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        button svg {
            margin-right: 8px;
        }

        /* Divider */
        .divider {
            text-align: center;
            margin: 24px 0;
            color: var(--color-fg-muted);
            font-size: 12px;
            font-weight: 600;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 45%;
            height: 1px;
            background-color: var(--color-border-default);
        }

        .divider::before { left: 0; }
        .divider::after { right: 0; }

        /* Error Messages */
        .error-message {
            padding: 12px 16px;
            margin-bottom: 16px;
            color: var(--color-danger-fg);
            background-color: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--color-danger-emphasis);
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Tabs */
        #tab-bar {
            display: flex;
            border-bottom: 1px solid var(--color-border-default);
            background-color: var(--color-canvas-subtle);
            overflow-x: auto;
            scrollbar-width: thin;
        }

        #tab-bar::-webkit-scrollbar {
            height: 6px;
        }

        #tab-bar::-webkit-scrollbar-thumb {
            background-color: var(--color-border-muted);
            border-radius: 3px;
        }

        .tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            font-size: 14px;
            color: var(--color-fg-muted);
            background-color: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .tab:hover {
            color: var(--color-fg-default);
            background-color: var(--color-neutral-muted);
        }

        .tab.active {
            color: var(--color-fg-default);
            font-weight: 600;
            border-bottom-color: var(--color-accent-emphasis);
            background-color: var(--color-canvas-default);
        }

        #new-tab-button {
            font-size: 20px;
            font-weight: bold;
            padding: 8px 16px;
        }

        .tab-close {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            font-size: 16px;
            line-height: 1;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .tab-close:hover {
            background-color: var(--color-border-default);
        }

        /* Chat Interface */
        #chat-messages {
            height: 400px;
            overflow-y: auto;
            border: 1px solid var(--color-border-default);
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background-color: var(--color-canvas-default);
        }

        #chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        #chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--color-border-muted);
            border-radius: 4px;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--color-accent-emphasis);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message.assistant .message-avatar {
            background-color: var(--color-success-emphasis);
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background-color: var(--color-accent-emphasis);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.assistant .message-content {
            background-color: var(--color-canvas-subtle);
            border: 1px solid var(--color-border-default);
            border-bottom-left-radius: 4px;
        }

        /* Chat Input */
        #chat-input {
            display: flex;
            gap: 8px;
        }

        #chat-input input {
            flex: 1;
            margin: 0;
        }

        #chat-input button {
            margin: 0;
            padding: 8px 20px;
        }

        /* Mobile Menu */
        #mobile-menu-button {
            display: none;
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            color: var(--color-fg-default);
            font-size: 20px;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            main {
                padding: 0;
            }

            .layout {
                flex-direction: column;
            }

            #app-nav {
                position: fixed;
                top: 0;
                left: -100%;
                width: 80%;
                max-width: 300px;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                padding-top: 60px;
                border-radius: 0;
                border: none;
                border-right: 1px solid var(--color-border-default);
            }

            #app-nav.open {
                left: 0;
            }

            #mobile-menu-button {
                display: block;
            }

            .message {
                max-width: 95%;
            }

            .page {
                border-radius: 0;
                border-left: none;
                border-right: none;
            }

            .page-header input[type="search"] {
                flex: 1;
            }
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--color-border-default);
            border-top-color: var(--color-accent-emphasis);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 24px;
            text-align: center;
            color: var(--color-fg-muted);
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
            fill: currentColor;
        }

        .empty-state h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px 0;
            color: var(--color-fg-default);
        }

        .empty-state p {
            margin: 0 0 24px 0;
            font-size: 14px;
        }

        /* Settings Cards */
        .settings-card {
            padding: 16px;
            margin-bottom: 16px;
            background-color: var(--color-canvas-subtle);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
        }

        .settings-card h3 {
            font-size: 14px;
            font-weight: 600;
            margin: 0 0 8px 0;
        }

        .settings-card p {
            font-size: 14px;
            color: var(--color-fg-muted);
            margin: 0 0 16px 0;
        }

        /* Links */
        a {
            color: var(--color-accent-fg);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        p {
            color: var(--color-fg-muted);
            margin-top: 0;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay" onclick="closeMobileMenu()"></div>
    <main id="main-layout">
        <nav id="app-nav">
            <a href="#/Home">
                <svg viewBox="0 0 16 16"><path d="M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.438 1.157a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V9.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z"></path></svg>
                Início
            </a>
            
            <div class="collapsible">
                <div class="collapsible-header" onclick="toggleCollapsible(this)">
                    <span>Chats Recentes</span>
                    <span class="arrow">▶</span>
                </div>
                <div id="recent-chats-list" class="collapsible-content"></div>
            </div>
            
            <a href="#/Settings">
                <svg viewBox="0 0 16 16"><path d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.038.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.211.224l-.29 1.106c-.168.646-.715 1.196-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.064-1.289-.614-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.224a5.738 5.738 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.12 8.12 0 0 1-.704-1.218c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.214 6.214 0 0 1 0-.772c.01-.147-.038-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.211-.224l.29-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.105c-.147.561-.549.967-.998 1.189-.173.086-.34.183-.5.29-.417.278-.97.423-1.529.27l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.411.406.562.957.53 1.456a4.709 4.709 0 0 0 0 .582c.032.499-.119 1.05-.53 1.456l-.815.806c-.081.08-.073.159-.059.19.162.346.353.677.573.989.02.03.085.076.195.046l1.102-.303c.56-.153 1.113-.008 1.53.27.161.107.328.204.501.29.447.222.85.629.997 1.189l.289 1.105c.029.109.101.143.137.146a6.6 6.6 0 0 0 1.142 0c.036-.003.108-.036.137-.146l.289-1.105c.147-.561.549-.967.998-1.189.173-.086.34-.183.5-.29.417-.278.97-.423 1.529-.27l1.103.303c.109.029.175-.016.195-.045.22-.313.411-.644.573-.99.014-.031.021-.11-.059-.19l-.815-.806c-.411-.406-.562-.957-.53-1.456a4.709 4.709 0 0 0 0-.582c-.032-.499.119-1.05.53-1.456l.815-.806c.081-.08.073-.159.059-.19a6.464 6.464 0 0 0-.573-.989c-.02-.03-.085-.076-.195-.046l-1.102.303c-.56.153-1.113.008-1.53-.27a4.44 4.44 0 0 0-.501-.29c-.447-.222-.85-.629-.997-1.189l-.289-1.105c-.029-.11-.101-.143-.137-.146a6.6 6.6 0 0 0-1.142 0ZM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM9.5 8a1.5 1.5 0 1 0-3.001.001A1.5 1.5 0 0 0 9.5 8Z"></path></svg>
                Configurações
            </a>
        </nav>

        <div id="content-container">
            <!-- Home Page -->
            <section id="home-page" class="page">
                <div class="page-header">
                    <h1>Bem-vindo</h1>
                </div>
                <div class="page-content">
                    <div class="empty-state">
                        <svg viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path></svg>
                        <h3>Comece a usar o assistente</h3>
                        <p>Use o menu para iniciar uma nova conversa ou gerenciar suas configurações.</p>
                        <a href="#/Chat" class="button primary">Abrir Chats</a>
                    </div>
                </div>
            </section>

            <!-- Login Page -->
            <section id="login-page" class="page active">
                <div class="page-header">
                    <h1>Login</h1>
                </div>
                <div class="page-content">
                    <div class="form-container">
                        <div id="login-error" class="error-message"></div>
                        
                        <div class="form-group">
                            <label for="login-email">Email</label>
                            <input type="email" id="login-email" placeholder="voce@exemplo.com" required autocomplete="email">
                        </div>
                        
                        <div class="form-group">
                            <label for="login-password">Senha</label>
                            <input type="password" id="login-password" placeholder="••••••••" required autocomplete="current-password">
                        </div>
                        
                        <button class="primary full-width" onclick="loginWithEmail()">
                            <span id="login-btn-text">Entrar</span>
                            <span id="login-spinner" class="spinner" style="display: none;"></span>
                        </button>
                        
                        <div class="divider">ou</div>
                        
                        <button class="full-width" onclick="loginWithGithub()">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                            Login com GitHub
                        </button>
                        
                        <p style="text-align: center; margin-top: 24px;">
                            Não tem uma conta? <a href="#/Register">Registre-se</a>
                        </p>
                    </div>
                </div>
            </section>

            <!-- Register Page -->
            <section id="register-page" class="page">
                <div class="page-header">
                    <h1>Registro</h1>
                </div>
                <div class="page-content">
                    <div class="form-container">
                        <div id="register-error" class="error-message"></div>
                        
                        <div class="form-group">
                            <label for="register-email">Email</label>
                            <input type="email" id="register-email" placeholder="voce@exemplo.com" required autocomplete="email">
                        </div>
                        
                        <div class="form-group">
                            <label for="register-password">Senha (mínimo 6 caracteres)</label>
                            <input type="password" id="register-password" placeholder="Crie uma senha forte" required autocomplete="new-password">
                            <small style="color: var(--color-fg-muted); font-size: 12px;">Use pelo menos 6 caracteres</small>
                        </div>
                        
                        <button class="primary full-width" onclick="registerWithEmail()">
                            <span id="register-btn-text">Criar Conta</span>
                            <span id="register-spinner" class="spinner" style="display: none;"></span>
                        </button>
                        
                        <p style="text-align: center; margin-top: 24px;">
                            Já tem uma conta? <a href="#/Login">Faça Login</a>
                        </p>
                    </div>
                </div>
            </section>

            <!-- Settings Page -->
            <section id="settings-page" class="page">
                <div class="page-header">
                    <h1>Configurações</h1>
                </div>
                <div class="page-content">
                    <div style="max-width: 800px;">
                        <div class="settings-card">
                            <h3>Conta</h3>
                            <p>Informações sobre sua conta.</p>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background-color: var(--color-canvas-default); border-radius: 6px; margin-bottom: 16px;">
                                <div class="message-avatar" id="user-avatar">U</div>
                                <div>
                                    <div style="font-weight: 600;" id="user-email">Carregando...</div>
                                    <div style="font-size: 12px; color: var(--color-fg-muted);" id="user-provider">Provider: Email</div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-card" id="github-link-section">
                            <h3>Integração GitHub</h3>
                            <p>Para permitir que a IA acesse seus repositórios, conecte sua conta do GitHub.</p>
                            <button class="primary" onclick="linkGithubAccount()">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                                Conectar com GitHub
                            </button>
                        </div>

                        <div class="settings-card">
                            <h3>Zona de Perigo</h3>
                            <p>Ações relacionadas à sua conta.</p>
                            <button class="danger" onclick="logout()">Sair (Logout)</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Chat Page -->
            <section id="chat-page" class="page">
                <div class="page-header">
                    <button id="mobile-menu-button" onclick="toggleMobileMenu()">☰</button>
                    <input type="search" id="tab-search" placeholder="Buscar abas..." oninput="filterTabs(this.value)" style="flex: 1; margin: 0;">
                </div>
                <div id="tab-bar">
                    <div id="new-tab-button" class="tab" onclick="startNewChat()">+</div>
                </div>
                <div class="page-content">
                    <div id="chat-messages"></div>
                    <div id="chat-input">
                        <input type="text" id="message-input" placeholder="crie, leia ou edite um arquivo..." onkeydown="if(event.key==='Enter') sendMessage()">
                        <button class="primary" onclick="sendMessage()">Enviar</button>
                    </div>
                </div>
            </section>
            
            <!-- 404 Page -->
            <section id="not-found-page" class="page">
                <div class="page-header">
                    <h1>404</h1>
                </div>
                <div class="page-content">
                    <div class="empty-state">
                        <svg viewBox="0 0 16 16"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>
                        <h3>404 - Página não encontrada</h3>
                        <p>A página que você está procurando não existe.</p>
                        <a href="#" class="button">Voltar ao início</a>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyC0JUKA-uIHMpxLRtv7BwraOph3QOamxhA",
          authDomain: "github-ai-a4fcb.firebaseapp.com",
          projectId: "github-ai-a4fcb",
          storageBucket: "github-ai-a4fcb.firebasestorage.app",
          messagingSenderId: "99989504065",
          appId: "1:99989504065:web:fa916d2c5f69d44f9006c0"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let userToken = null, unsubscribeRecentChats = null;
        let openTabs = [], activeTabId = null, listeners = {};
        const githubUser = "Rain-Hub1";
        const repoDoAction = "Copilot";

        const routes = {
            "/Home": { page: "home-page", requiresAuth: true },
            "/Login": { page: "login-page" },
            "/Register": { page: "register-page" },
            "/Settings": { page: "settings-page", requiresAuth: true },
            "/Chat": { page: "chat-page", requiresAuth: true }
        };

        function detectDevice() {
            const isMobile = window.innerWidth <= 768;
            if (isMobile) {
                document.getElementById('main-layout').classList.remove('layout');
            } else {
                document.getElementById('main-layout').classList.add('layout');
            }
        }

        function toggleMobileMenu() {
            document.getElementById('app-nav').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('show');
        }

        function closeMobileMenu() {
            document.getElementById('app-nav').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
        }

        function toggleCollapsible(header) {
            header.classList.toggle("open");
            const content = header.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        }

        const urlLocationHandler = async () => {
            let location = window.location.hash.replace("#", "") || "/";
            let routeKey = Object.keys(routes).find(key => location.startsWith(key)) || "/404";
            let route = routes[routeKey] || { page: "not-found-page" };
            const user = auth.currentUser;
            document.getElementById('app-nav').style.display = user ? 'flex' : 'none';

            if (route.requiresAuth && !user) {
                window.location.hash = "/Login";
                return;
            }
            if (!route.requiresAuth && user) {
                window.location.hash = "/Home";
                return;
            }
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(route.page).classList.add('active');
            
            document.querySelectorAll('#app-nav a').forEach(a => a.classList.remove('active'));
            const activeLink = document.querySelector(`#app-nav a[href="#${routeKey}"]`);
            if (activeLink) activeLink.classList.add('active');
            
            if (route.page === 'settings-page' && user) {
                const emailEl = document.getElementById('user-email');
                const providerEl = document.getElementById('user-provider');
                const avatarEl = document.getElementById('user-avatar');
                
                if (emailEl) emailEl.textContent = user.email || 'Usuário';
                if (avatarEl) avatarEl.textContent = (user.email || 'U')[0].toUpperCase();
                
                const isGithubLinked = user.providerData.some(p => p.providerId === 'github.com');
                if (providerEl) providerEl.textContent = isGithubLinked ? 'Provider: GitHub' : 'Provider: Email';
                document.getElementById('github-link-section').style.display = isGithubLinked ? 'none' : 'block';
            }

            closeMobileMenu();
        };

        window.addEventListener("hashchange", urlLocationHandler);
        window.addEventListener("resize", detectDevice);
        
        auth.onAuthStateChanged(user => {
            userToken = null;
            if (unsubscribeRecentChats) unsubscribeRecentChats();
            Object.values(listeners).forEach(unsub => unsub());
            listeners = {};
            openTabs = [];
            activeTabId = null;

            if (user) {
                const githubProvider = user.providerData.find(p => p.providerId === 'github.com');
                if (githubProvider && user.za) {
                    userToken = user.za;
                }
                listenToRecentChats(user.uid);
                loadTabsFromStorage();
            }
            renderTabs();
            urlLocationHandler();
        });
        
        detectDevice();

        function displayError(elementId, error) {
            const defaultMessages = {
                'auth/invalid-email': 'O formato do email é inválido.',
                'auth/user-not-found': 'Nenhum usuário encontrado com este email.',
                'auth/wrong-password': 'A senha está incorreta.',
                'auth/email-already-in-use': 'Este email já está em uso por outra conta.',
                'auth/weak-password': 'A senha deve ter pelo menos 6 caracteres.',
                'auth/too-many-requests': 'Muitas tentativas. Tente novamente mais tarde.',
                'auth/network-request-failed': 'Erro de conexão. Verifique sua internet.'
            };
            const errorEl = document.getElementById(elementId);
            if (errorEl) {
                errorEl.textContent = defaultMessages[error.code] || 'Ocorreu um erro. Tente novamente.';
                errorEl.classList.add('show');
                setTimeout(() => errorEl.classList.remove('show'), 5000);
            }
        }

        function clearError(elementId) {
            const errorEl = document.getElementById(elementId);
            if (errorEl) {
                errorEl.textContent = '';
                errorEl.classList.remove('show');
            }
        }

        async function registerWithEmail() {
            clearError('register-error');
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            
            if (!email || !password) {
                displayError('register-error', { code: 'auth/invalid-email' });
                return;
            }
            
            const btn = document.querySelector('#register-page button.primary');
            const btnText = document.getElementById('register-btn-text');
            const spinner = document.getElementById('register-spinner');
            
            btn.disabled = true;
            btnText.style.display = 'none';
            spinner.style.display = 'inline-block';
            
            try {
                await auth.createUserWithEmailAndPassword(email, password);
            } catch (error) {
                displayError('register-error', error);
            } finally {
                btn.disabled = false;
                btnText.style.display = 'inline';
                spinner.style.display = 'none';
            }
        }

        async function loginWithEmail() {
            clearError('login-error');
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                displayError('login-error', { code: 'auth/invalid-email' });
                return;
            }
            
            const btn = document.querySelector('#login-page button.primary');
            const btnText = document.getElementById('login-btn-text');
            const spinner = document.getElementById('login-spinner');
            
            btn.disabled = true;
            btnText.style.display = 'none';
            spinner.style.display = 'inline-block';
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                displayError('login-error', error);
            } finally {
                btn.disabled = false;
                btnText.style.display = 'inline';
                spinner.style.display = 'none';
            }
        }

        function loginWithGithub() {
            const provider = new firebase.auth.GithubAuthProvider();
            provider.addScope('repo');
            auth.signInWithPopup(provider).then(result => {
                const credential = result.credential;
                userToken = credential.accessToken;
            }).catch(error => displayError('login-error', error));
        }
        
        function linkGithubAccount() {
            const provider = new firebase.auth.GithubAuthProvider();
            provider.addScope('repo');
            auth.currentUser.linkWithPopup(provider).then(result => {
                const credential = result.credential;
                userToken = credential.accessToken;
                urlLocationHandler();
            }).catch(error => alert('Erro ao conectar conta do GitHub: ' + error.message));
        }

        function logout() {
            auth.signOut();
        }

        function saveTabsToStorage() {
            if (!auth.currentUser) return;
            localStorage.setItem(`tabs_${auth.currentUser.uid}`, JSON.stringify(openTabs));
        }

        function loadTabsFromStorage() {
            if (!auth.currentUser) return;
            const savedTabs = localStorage.getItem(`tabs_${auth.currentUser.uid}`);
            if (savedTabs) {
                openTabs = JSON.parse(savedTabs);
                if (openTabs.length > 0) {
                    setActiveTab(openTabs[0].id);
                }
            }
        }

        function renderTabs() {
            const tabBar = document.getElementById('tab-bar');
            document.querySelectorAll('.tab:not(#new-tab-button)').forEach(t => t.remove());
            
            openTabs.forEach(tab => {
                const tabEl = document.createElement('div');
                tabEl.className = 'tab';
                tabEl.dataset.tabId = tab.id;
                if (tab.id === activeTabId) tabEl.classList.add('active');
                
                const title = document.createElement('span');
                title.textContent = tab.title;
                title.style.overflow = 'hidden';
                title.style.textOverflow = 'ellipsis';
                title.style.maxWidth = '150px';
                
                const closeBtn = document.createElement('span');
                closeBtn.className = 'tab-close';
                closeBtn.innerHTML = '&times;';
                closeBtn.onclick = (e) => { e.stopPropagation(); closeTab(tab.id); };
                
                tabEl.append(title, closeBtn);
                tabEl.onclick = () => setActiveTab(tab.id);
                tabBar.appendChild(tabEl);
            });
            
            const chatContent = document.getElementById('chat-messages');
            chatContent.innerHTML = '';
            if (activeTabId) {
                const activeTabData = openTabs.find(t => t.id === activeTabId);
                if (activeTabData) {
                    activeTabData.messages.forEach(displayMessage);
                    chatContent.scrollTop = chatContent.scrollHeight;
                }
            }
        }

        function filterTabs(query) {
            document.querySelectorAll('.tab:not(#new-tab-button)').forEach(tabEl => {
                const tabTitle = tabEl.querySelector('span').textContent.toLowerCase();
                tabEl.style.display = tabTitle.includes(query.toLowerCase()) ? 'flex' : 'none';
            });
        }

        function setActiveTab(chatId) {
            if (!openTabs.some(t => t.id === chatId)) {
                openTab(chatId);
                return;
            }
            activeTabId = chatId;
            if (!listeners[chatId]) {
                listenToChat(chatId);
            }
            renderTabs();
        }

        function openTab(chatId, title = 'Carregando...') {
            if (openTabs.some(t => t.id === chatId)) {
                setActiveTab(chatId);
                return;
            }
            openTabs.unshift({ id: chatId, title: title, messages: [] });
            setActiveTab(chatId);
            saveTabsToStorage();
        }

        function closeTab(chatId) {
            openTabs = openTabs.filter(t => t.id !== chatId);
            if (listeners[chatId]) {
                listeners[chatId]();
                delete listeners[chatId];
            }
            if (activeTabId === chatId) {
                activeTabId = openTabs.length > 0 ? openTabs[0].id : null;
                if (activeTabId) setActiveTab(activeTabId);
            }
            saveTabsToStorage();
            renderTabs();
        }

        function startNewChat() {
            if (!auth.currentUser) return;
            const newChatId = `chat_${auth.currentUser.uid}_${Date.now()}`;
            const chatDoc = db.collection('chats').doc(newChatId);
            chatDoc.set({
                owner: auth.currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                lastMessage: 'Novo Chat'
            }).then(() => {
                const messagesSubCol = chatDoc.collection('messages');
                messagesSubCol.add({
                    role: 'assistant',
                    content: 'Olá! Sou seu assistente de IA. Peça-me para criar, ler ou editar um arquivo.',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    openTab(newChatId, 'Novo Chat');
                });
            });
        }

        function listenToChat(chatId) {
            if (listeners[chatId]) return;
            const messagesCol = db.collection('chats').doc(chatId).collection('messages').orderBy('timestamp');
            listeners[chatId] = messagesCol.onSnapshot(snapshot => {
                const tab = openTabs.find(t => t.id === chatId);
                if (tab) {
                    tab.messages = snapshot.docs.map(doc => doc.data());
                    if (chatId === activeTabId) {
                        renderTabs();
                    }
                }
            });
        }

        function listenToRecentChats(userId) {
            const chatsQuery = db.collection('chats').where('owner', '==', userId).orderBy('createdAt', 'desc').limit(5);
            unsubscribeRecentChats = chatsQuery.onSnapshot(snapshot => {
                const list = document.getElementById('recent-chats-list');
                list.innerHTML = '';
                if (snapshot.empty) {
                    const noChats = document.createElement('a');
                    noChats.textContent = 'Nenhum chat recente';
                    noChats.style.cursor = 'default';
                    noChats.style.color = 'var(--color-fg-muted)';
                    list.appendChild(noChats);
                } else {
                    snapshot.forEach(doc => {
                        const link = document.createElement('a');
                        link.href = `#/Chat`;
                        link.textContent = doc.data().lastMessage || 'Chat sem título';
                        link.onclick = (e) => { e.preventDefault(); window.location.hash = '#/Chat'; openTab(doc.id, doc.data().lastMessage); };
                        list.appendChild(link);
                    });
                }
            });
        }

        function displayMessage(message) {
            const chatBox = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${message.role}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = message.role === 'user' ? 'U' : 'AI';
            
            if (message.role === 'user' && auth.currentUser && auth.currentUser.email) {
                avatar.textContent = auth.currentUser.email[0].toUpperCase();
            }
            
            const content = document.createElement('div');
            content.className = 'message-content';
            content.textContent = message.content;
            
            msgDiv.appendChild(avatar);
            msgDiv.appendChild(content);
            chatBox.appendChild(msgDiv);
        }

        async function sendMessage() {
            if (!userToken) {
                alert('Por favor, conecte sua conta do GitHub em Configurações para usar a IA.');
                window.location.hash = '/Settings';
                return;
            }
            const input = document.getElementById('message-input');
            const content = input.value.trim();
            if (!content || !activeTabId) return;
            input.value = '';
            
            const chatDoc = db.collection('chats').doc(activeTabId);
            const messagesCol = chatDoc.collection('messages');
            
            await messagesCol.add({
                role: 'user',
                content: content,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            await chatDoc.update({ lastMessage: content });
            
            const tab = openTabs.find(t => t.id === activeTabId);
            if (tab && tab.title === 'Novo Chat') tab.title = content.substring(0, 20) + '...';
            saveTabsToStorage();
            renderTabs();

            await fetch(`https://api.github.com/repos/${githubUser}/${repoDoAction}/actions/workflows/processar.yml/dispatches`, {
                method: 'POST',
                headers: { 'Authorization': `token ${userToken}`, 'Accept': 'application/vnd.github.v3+json' },
                body: JSON.stringify({ ref: 'main', inputs: { chatId: activeTabId } })
            });
        }
    </script>
</body>
</html>
